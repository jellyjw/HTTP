## 상태 코드

상태코드란, 클라이언트가 보낸 요청의 처리 상태를 응답에서 알려주는 기능이다.

주로 쓰이는 상태코드는 100번대부터 500번대까지인데, 각 코드의 의미는 다음과 같다.

- 1xx (Informational) : 요청이 수신되어 처리중
- 2xx (Successful) : 요청 정상 처리
- 3xx (Redirection) : 요청을 완료하려면 추가 행동이 필요
- 4xx (Client Error) : 클라이언트 오류, 서버가 요청 수행 불가
- 5xx (Server Error) : 서버 오류, 서버가 정상 요청을 수행하지 못함

만약 모르는 상태코드로 응답을 받더라도 상위 상태코드로 해석해서 처리하면 되기 때문에, 미래에 새로운 상태코드가 추가되어도 클라이언트를 변경하지 않아도 된다.

예를들어 420번대 코드를 받았으면, 400번대는 클라이언트 에러라는 의미를 가지고 있기 때문에 요청에 문제가 있는지를 확인하면 되는 것이다.

### 1xx (Informational)

요청이 수신되어 처리중일때 쓰이는 코드이지만, 거의 사용하지 않는다.

### 2xx (Successful)

클라이언트의 요청을 성공적으로 처리했다는 의미이다.

- 200 OK : 요청을 성공했을때 받게되는 상태코드, 주로 `GET` 요청의 응답으로 가장 많이 받게 된다.
- 201 Created : 요청을 성공해서 새로운 리소스가 생성되었다는 의미로 주로 `POST` 요청을 보냈을때 해당 코드를 받게 된다. 생성된 리소스는 응답의 `Location` 헤더 필드로 식별이 가능하다.

![image](https://github.com/jellyjw/HTTP/assets/104891203/d64408d3-4e65-4af1-bc83-619cc9134816)

- 202 Accepted : 요청이 접수되었으나 처리가 완료되지 않았을 경우, 예를 들어 요청 접수 후 1시간 뒤에 배치 프로세스가 요청을 처리할때 사용된다.
- 204 No Content : 요청을 성공적으로 수행했지만, 응답으로 보낼 데이터가 없을때 사용된다. 예를 들어 웹 문서 편집기에서 저장 버튼을 눌렀을때 서버에 저장은 되었지만 서버에서 굳이 응답 데이터를 보내주지 않고 저장이 성공적으로 되었다는 사실만 보내줘도 되기 때문에, 결과 내용이 없어도 204 메세지만으로 성공을 인식할수 있다.

### 3xx (Redirection)

요청을 완료하기 위해 유저 에이전트의 추가 조치가 필요

300번대 요청은 주로 리다이렉션에 쓰이는데, 리다이렉션은 웹브라우저가 300번대 응답을 받게 되었을때 결과에 `Location` 헤더가 있으면 해당 위치로 자동으로 이동(리다이렉트) 되는 것을 의미한다.

![image](https://github.com/jellyjw/HTTP/assets/104891203/c2843d15-2a33-457d-a2a8-95d823bb5165)

1. 클라이언트가 GET 요청을 보냄
2. 서버의 응답이 3xx 코드로 왔고 `Location` 에 경로 `/new-event` 가 있다면
3. 자동으로 브라우저에서 기존 `/event` 경로에서 `/new-event` 경로로 바꿔준다.
4. 그리고 해당 URI 로 `GET` 요청을 다시 보낸다.
5. 서버에서는 요청에 대한 응답을 보내준다.

### 리다이렉션 종류

- 영구 리다이렉션 : 특정 리소스의 URI 가 영구적으로 이동되었을 경우
  - /members → /users
  - /event → /new-event
- 일시 리다이렉션 : 일시적인 변경
  - 결제 완료 후 결제 내역으로 이동해야 할 때
  - PRG (POST / Redirect / GET)
- 특수 리다이렉션 : 결과 대신 캐시를 사용
  - 캐시가 만료되었는지에 대한 여부를 판별 가능

---

## 영구 리다이렉션 - 301, 308

만약 결과 리소스를 포함하는 `result` 페이지를 `analysis` 페이지로 변경하고자 한다면? 기존 `result` URL을 사용하면 안되고, 영구적으로 이동되어야 한다.

유저는 `result` 페이지를 북마크 해놨을 수도 있고, 여기저기 링크를 공유했을수도 있다. URI가 변경된걸 모르는 유저는 `result` 페이지를 주소창에 치고 들어갈 것이다.

이때 서버에서 3xx 응답과 함께 location에 `analysis` 를 보내준다면, 웹브라우저는 자동으로 location에 있는 주소로 바꿔서 응답을 보내주게 되고 검색엔진등에서도 변경을 인지할수 있다.

301과 308의 차이에 대해서 알아보자.

### 301 - Moved Permanently

301은 리다이렉트시 요청 메서드가 `GET` 으로 변하고, 본문이 제거될 수 있다.

→ 유저가 `event` 에 참여하려고 `POST` 로 이벤트 참여 정보를 담아 요청을 보냈는데, 서버에서 301 응답을 보내줘서 다른 URI로 리다이렉트 될 경우 변경된 URI에 `GET` 요청으로 변경된다. 그래서 유저가 기존에 보낸 메세지가 제거된다는 특징이 있다.

### 308 - Permanent Redirect

301과 기능 자체는 동일하지만, **리다리엑트시 요청 메서드와 본문이 유지된다.**

→ 유저가 POST로 요청 보내고 리다이렉트 될 경우 POST 메서드와 바디가 유지된다.

---

## 일시적 리다이렉션 - 302, 307, 303

리소스의 URI가 일시적으로 변경되는 경우는 영구적 리다이렉션과 다르게 검색엔진에서 URL을 변경하면 안된다. B 경로로 리다이렉션 되었더라도, 다른 상황에서는 A 경로로 리다이렉션이 필요할수도 있기 때문이다.

### 302 - Found

리다이렉트시 요청 메서드가 `GET` 으로 변하고 본문이 제거될 수 있다 (**MAY**)

즉, 제거될 수도 있고 제거가 안될수도 있다는 점, 모호하다는 특징이 있다.

### 307 - Temporary Redirect

302와 기능은 동일하지만, 리다이렉트시 **요청 메서드와 본문이 유지된다.**

POST로 보냈을 경우 POST 메서드와 바디가 유지되는것, 요청 메서드를 변경하면 안된다! **MUST**

### 303 - See Other

303도 302와 기능은 동일하지만 리다이렉트시 요청 메서드가 **GET** 으로 변경된다.

모든 기능은 같지만 메서드가 변하고, 안변하고, 변할수도 있고 안변할수도 있다는 차이점이 있다.

하지만 실무에서는 여전히 302를 많이 사용하곤 한다.

### 역사와 현실

처음 302 스펙의 의도는 메서드를 유지하는것이었지만, 브라우저에서 메서드를 GET으로 바꿔버리면서 (일부는 다르게 동작) 모호해졌다. 그래서 명확한 303이나 307이 등장했다.

하지만 현실은 많은 애플리케이션 라이브러리들이 302를 기본값으로 사용하고 있다.

자동 리다이렉션시 GET으로 변해도 되면, 302를 사용해도 큰 문제가 없다.

---

## PRG : POST / Redirect / GET

웹 개발자들이 한번은 겪을수 있는 상황중 하나로, POST로 요청을 보내고 새로고침을 할 경우 요청이 한번 더 가게 되면서 만약 상품 주문 페이지에서 POST로 상품 구매에 필요한 정보를 보냈을 시 한번 더 구매요청이 가게 되는 상황이 발생한다.

사실 이런 경우는 서버에서 잘 막아주는게 중요하고, 브라우저에서도 경고를 띄워주긴 하지만 PRG를 이용하면 이런 에러들을 줄일수 있다.

**PRG** 는 POST로 요청을 보내고나서 Redirect 시킨 뒤 GET 메서드로 변경해 새로고침을 하더라도 결과만 계속 조회되게끔 하는것이다. 실무에서 정말 많이 사용한다.

- POST 로 주문 후에 새로고침으로 인한 중복 주문 방지
- 주문 결과 화면을 GET 메서드로 리다이렉트
- 새로고침해도 결과 화면만 GET

## 기타 리다이렉션 - 300, 304

### 300 - Multiple Choices

거의 사용하지 않는다.

### 304 - Not Modified

캐시를 목적으로 사용하는 상태코드로, 클라이언트에게 리소스가 수정되지 않았음을 알려준다.

클라이언트는 로컬 PC에 저장된 캐시를 재사용한다. (캐시로 리다이렉트)

중요! **로컬 캐시를 사용해야 하기 때문에 응답에 메세지 바디를 포함하면 안된다.**

예를 들어 큰 용량의 이미지를 요청해야 할 경우, 캐시에 남아있긴 한데 이게 업데이트 되었는지 안되었는지를 몰라서 서버에 요청을 보내면 서버에서 업데이트 되지 않았으니 로컬 캐시에 있는 이미지를 그대로 사용하라는 의미로 304 코드를 보내주는것, 그러면 브라우저는 로컬 캐시에 저장된 이미지를 그대로 사용하게 되고 네트워크 용량이 많이 줄어들게 된다.

---

## 4xx (Client Error)

클라이언트의 요청에 뭔가 문제가 있을 경우, 오류의 원인이 클라이언트에 있을때 받게 되는 코드이다.

### 400 - Bad Request

클라이언트가 잘못된 요청을 해서 서버가 요청을 처리할수 없다는 의미

- 요청 구문, 메세지 오류
- 클라이언트가 요청 재검토후 다시 보내야 함
- 요청 파라미터, API 스펙 확인

### 401 - Unauthorized

클라이언트가 해당 리소스에 대한 인증이 필요할 때

- 인증이 되지 않았을 경우(로그인)
- 응답에 WWW-Authenticate 헤더와 함께 인증 방법을 설명
- 참고
  - 인증(Authentication) : 본인이 누구인지 확인(로그인)
  - 인가(Authorization) : 권한 부여(Admin 등급이 아닌데 Admin 리소스에 접근하려고 할 경우)

### 403 - Forbidden

서버가 요청을 이해했지만 승인을 거부함

마찬가지로 어드민 등급이 아닌 사용자가 로그인은 했지만 어드민 리소스에 접근하는 경우

### 404 - Not Found

리소스를 찾을 수 없을때, 클라이언트가 해당 리소스를 숨기고 싶을 때 사용

---

## 5XX (Server Error)

서버 오류, 서버에 오류의 원인이 있음.

서버에 문제가 있기 때문에 복구가 되었을 경우 요청을 다시 보내면 성공할수도 있음.

### 500 - Internal Server Error

서버 문제로 오류 발생, 애매하면 500 오류 보냄

### 503 - Service Unavailable

서버 일시적 과부화 또는 예정된 작업으로 서버를 다운시켰을때 사용

---

### 400, 500 구분하는 중요한 차이

바로 **동일한 요청을 보냈을때 성공 가능성** 에 있는데, 400번대는 요청 자체가 잘못되었기 때문에 재요청을 아무리 보내도 성공 가능성이 없지만 500번대는 서버가 복구되거나 하면 재요청을 보내도 성공할 가능성이 있다는 차이점이 있다.
