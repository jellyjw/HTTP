# [Section_7] HTTP 헤더 1

## 캐시가 없을 경우

- 데이터가 변경되지 않아도 네트워크를 통해 데이터를 다운로드 받아야 함.
- 인터넷 네트워크는 매우 느리고 비쌈.
- 브라우저 로딩 속도가 느려짐
- UX 저하

## HTTP 헤더에서의 캐시

`cache-control` 값의 `max-age` 는 이 시간동안 캐시가 유효하다는 뜻이다.

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/934968c3-f6ae-46ad-8423-aec44f8c9ba4/5be25bc0-a7af-4bc1-a272-0adf68885ef1/Untitled.png)

두번째 요청시에 무조건 캐시에서 조회하고, 있으면 캐시에서 가져오게 된다.

### 캐시 적용시

- 캐시 가능 시간동안 네트워크 사용 X
- 빠른 사용자 경험
- 로딩속도 빨라짐
- 비싼 네트워크 사용량 줄일 수 있음

### 캐시 시간 초과시

- 서버를 통해 데이터를 다시 조회하고 캐시를 갱신한다. → stale 이라고 함.
- 이때 다시 네트워크 다운로드가 발생한다.
    - 만약 전혀 이미지가 변하지 않았는데, 60초가 지났다고 다시 다운로드 받아야 한다면?

### 검증 헤더와 조건부 요청

캐시 유효시간이 초과해서, 서버에 다시 요청할 경우

1. 서버에서 기존 데이터를 변경함(노란 별 → 초록 별)
2. 서버에서 기존 데이터를 변경하지 않음
    1. 이때 동일한 데이터인지 확인할 필요가 있는데, 이때 쓰이는게 검증헤더이다. 

### 검증 헤더

`Last-Modified` 라는 헤더를 추가해서, 최종 수정일을 기록해둔다.

![image](https://github.com/jellyjw/HTTP/assets/104891203/0c359721-e2c0-4081-becf-00839e502db4)

첫번째로 `Cache-Control` 의 시간이 지나면, 서버에 다시 요청을 보내야 하는데 캐시에 `last modified` 가 있을 경우 서버 데이터의 최종 수정일자와 비교해서 달라졌을 경우 다시 다운받고, 수정이 안됐을 경우 304 응답을 보내게 된다.

### 수정이 되지 않았을 경우(Last-Modified가 다를경우)

![image](https://github.com/jellyjw/HTTP/assets/104891203/6e3bd962-14aa-4928-a94d-8e08360349c1)

**캐시 유효시간이 초과해도, 서버 데이터가 갱신되지 않으면 `304 Not Modified` 와 함께 헤더 메타 정보만 응답한다.**

클라이언트는 서버가 보낸 응답 헤더 정보로 캐시 메타 정보를 갱신하고,

캐시에 저장되어있는 데이터를 재활용할 수 있게 된다.

결과적으로 네트워크 다운로드는 발생하나, 용량이 매우 적은 헤더만 다운로드 되기 때문에 네트워크 부하가 발생하지 않는다.

![image](https://github.com/jellyjw/HTTP/assets/104891203/d7843a61-9a6a-42dd-bba8-ee0b0c594e47)